# ext2 文件系统的实现

## 一，基本知识

### 1.1. 硬盘的基本知识

1. 盘面(platter)
   硬盘中一般会有多个盘片组成，每个盘片包含两个面，每个盘面都对应地有一个读/写磁头。受到硬盘整体体积和生产成本的限制，盘片数量都受到限制，一般都在 5 片以内。盘片的编号自下向上从 0 开始，如最下边的盘片有 0 面和 1 面，再上一个盘片就编号为 2 面和 3 面。
2. 柱面(cylinder)
   硬盘通常由重叠的一组盘片构成，每个盘面都被划分为数目相等的磁道，并从外缘的“0”开始编号，具有相同编号的磁道形成一个圆柱，称之为磁盘的柱面。磁盘的柱面数与一个盘面上的磁道数是相等的。由于每个盘面都有自己的磁头，因此，盘面数等于总的磁头数。
3. 磁道(track)
4. 物理扇区(physical sector)
   随着硬盘容量的不断增加，为了提高数据记录密度，硬盘厂商往往采用增大扇区大小的方法，于是出现了扇区为 4096 字节的硬盘
5. 逻辑扇区(logical sector)
   为了解决部分系统或软件的兼容性问题，硬盘内部将物理扇区在逻辑上划分为多个扇区片段并将其作为普通扇区，一般大小为 512 字节。实际读写时由硬盘内的程序（固件）负责在逻辑扇区与物理扇区之间进行转换，上层程序“感觉”不到物理扇区的存在。
6. 磁盘块(block)

   **文件系统**读写数据的最小单位，也叫磁盘簇。扇区是磁盘最小的物理存储单元，操作系统将相邻的扇区组合在一起，形成一个块，对块进行管理。每个磁盘块可以包括 2、4、8、16、32 或 64 个扇区。磁盘块是操作系统所使用的逻辑概念，而非磁盘的物理概念。

### 1.2. ext2 文件系统的结构

由前面可知，文件系统读写数据的最小单位是**block**，在操作系统的视野中，一个磁盘就是由一大堆 block 组成的结构。要在这一大堆 block 中存储我们的文件和目录之类的各种各样的信息，首先就要规划好一个合理的文件系统结构。今天在市面上的文件系统已经非常多了，像 Windows 家用的 NTFS，还有 Linux 现在使用的 ext4 都是我们熟悉的文件系统。因为 ext 文件系统家族的思想没有太大的改变，ext3、ext4 都是对前者结构的优化及改善，所以这次我们实现一个 ext2 文件系统，以此来理解并彻底掌握 ext2 文件系统的组成原理。

如下图为 ext2 文件系统的基本结构：

![img](https://gitee.com/MiaoHN/PictureMap/raw/master/img/3790176-4ece675e15d09e8e.jpeg)

首先看上面的一部分。在一个保存有操作系统代码的磁盘中，最前面的

#### Super Block

super block 信息

![image-20211121110021924](https://gitee.com/MiaoHN/PictureMap/raw/master/img/image-20211121110021924.png)

## 二，开始编写

### 2.1. 使用一个文件模拟硬盘

### 2.2. 写出一个基本的 ext2 文件结构

### 2.3. 添加一个方便操作的 shell 程序

## Reference

1. [存储基础知识：扇区与块/簇](https://www.cnblogs.com/kerrycode/p/12701772.html)
2. [Linux EXT2 文件系统](https://www.cnblogs.com/sparkdev/p/11212734.html)
3. [Ext2 文件系统简单剖析（一）](https://www.jianshu.com/p/3355a35e7e0a)
